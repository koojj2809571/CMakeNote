太棒了。在 C++ 工程化中，**良好的目录结构**是成功的一半。我们将按照工业级标准，把项目重构为包含“库（Library）”和“主程序”的结构。

这种结构的好处是：你可以把核心逻辑封装在库里，未来可以轻松地被多个不同的程序引用。

### 1. 推荐的项目结构

首先，在你的 `~/package` 目录下，建立如下结构：

Plaintext

```
~/package/
├── CMakeLists.txt        # 顶层（Root）CMakeLists
├── include/              # 公共头文件
│   └── my_math.h
├── src/                  # 源代码
│   ├── my_math.cpp       # 库的实现
│   └── main.cpp          # 主程序入口
```

---

### 2. 编写代码文件

**`include/my_math.h`**

C++

```
#pragma once
int add(int a, int b);
```

**`src/my_math.cpp`**

C++

```
#include "my_math.h"
int add(int a, int b) {
    return a + b;
}
```

**`src/main.cpp`**

C++

```
#include <iostream>
#include "my_math.h" // 引用库的头文件

int main() {
    std::cout << "1 + 2 = " << add(1, 2) << std::endl;
    return 0;
}
```

---

### 3. 编写核心 `CMakeLists.txt` (Modern 风格)

这是最关键的一步，我们将展示如何使用 **`target_include_directories`** 来优雅地管理头文件路径。

CMake

```
cmake_minimum_required(VERSION 3.13)
project(MyMathProject LANGUAGES CXX)

# --- 1. 创建库 (Library) ---
# 将 my_math.cpp 编译成一个名为 MyMathLib 的库
add_library(MyMathLib src/my_math.cpp)

# 给这个库绑定头文件搜索路径
# PUBLIC 表示：
#   a) 编译 MyMathLib 内部需要 include 目录
#   b) 任何链接 MyMathLib 的目标（比如下文的 main），也会自动获得这个 include 目录
target_include_directories(MyMathLib PUBLIC include)


# --- 2. 创建可执行文件 (Executable) ---
add_executable(MyApp src/main.cpp)

# --- 3. 建立链接关系 ---
# 这一步非常强大：MyApp 链接了 MyMathLib，
# 它不仅获得了二进制代码，还自动获得了上面通过 PUBLIC 传递的头文件路径
target_link_libraries(MyApp PRIVATE MyMathLib)
```

---

### 4. 再次运行构建命令

回到终端，执行你最熟悉的动作：

Bash

```
# 配置（CMake 会自动处理 include 路径映射）
cmake -S . -B build

# 构建
cmake --build build

# 运行
./build/MyApp
```

---

### 为什么我们要这么写？（Modern CMake 的精髓）

你会发现，在编写 `MyApp` 的配置时，我们**完全没有写** `include_directories(...)`。

- **传统写法（不推荐）：** 全局强制添加包含路径，导致项目变大后，所有文件都能看到所有头文件，极其容易发生命名冲突。
    
- **Modern 写法（推荐）：** 路径信息是绑定在 `MyMathLib` 这个**对象（Target）**上的。当你链接这个对象时，相关的属性会自动“流向”你。这被称为 **Transitive Usage Requirements（传递性使用要求）**。
    

### 思考题

如果我把 `target_include_directories` 里的 `PUBLIC` 改成 `PRIVATE`，你觉得 `main.cpp` 在编译时会报错吗？

**如果你准备好了，我们可以聊聊如何在这种结构下加入“第三方库”（比如 GoogleTest 或 OpenCV）。**